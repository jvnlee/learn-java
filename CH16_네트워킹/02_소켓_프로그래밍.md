# 소켓 프로그래밍

`Java`는 `java.net` 패키지를 통해 소켓 프로그래밍을 지원.

소켓 통신에 사용되는 프로토콜에 따라 다른 종류의 소켓을 구현해서 제공함.

> <b>소켓(socket)</b>
>
> 프로세스 간의 통신에 사용되는 endpoint

&nbsp;

## TCP와 UDP

TCP/IP 프로토콜은 데이터가 의도된 목적지에 닿을 수 있도록 보장해주는 통신 규약

> 정확하게는 프로토콜의 집합으로, 총 4개의 계층(layer)으로 이루어져 있으며 각 계층에는 다양한 프로토콜이 존재함

TCP와 UDP 모두 TCP/IP 프로토콜의 3번째 layer인 Transport Layer에 해당하는 프로토콜

Transport Layer는 송신자의 데이터가 수신자 측의 프로세스 중 어느 프로세스로 향해야하는지 (= 몇번 port로 향해야하는지)를 지정해주거나 해석하는 역할이라고 보면 됨

&nbsp;

|             | <center>TCP</center>                                                                                                                                                                                                                                            | <center>UDP</center>                                                                                                                                                                                                                            |
| :---------: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  연결 방식  | 연결 기반(connection-oriented)<br/>- 연결 후 통신(전화기와 유사)<br/>- 1:1 통신                                                                                                                                                                                 | 비 연결기반(connectionless-oriented)<br/>- 연결 없이 통신 (소포와 유사)<br/>- 1:1, 1:n, n:n 통신                                                                                                                                                |
|    특징     | 1. 데이터 경계 구분 안함<br/>2. 신뢰성 있는 데이터 전송<br/> - 데이터의 전송 순서 보장<br/>- 데이터의 수신 여부 체크<br/>(손실되면 재전송함)<br/>- 패킷을 관리할 필요 없음<br/>3. UDP에 비해 전송 속도 느림<br/>(connection을 열고 닫는 과정을 항상 해야하므로) | 1. 데이터의 경계를 구분<br/>2. 신뢰성 없는 데이터 전송<br/>- 데이터의 전송 순서가 바뀔 수도 있음<br/>- 데이터의 수신 여부를 체크 안함<br/>(손실되어도 알 수 없으므로 재전송도 안해줌)<br/>- 패킷을 관리해주어야함<br/>3. TCP보다 전송 속도 빠름 |
| 관련 클래스 | `Socket`, `ServerSocket`                                                                                                                                                                                                                                        | `DatagramSocket`, `DatagramPacket`, `MulticastSocket`                                                                                                                                                                                           |

&nbsp;

TCP는 파일 송수신처럼 조금 느리더라도 데이터가 유실되지 않는게 중요한 경우에 쓰임

UDP는 게임이나 영상 데이터 등 조금 끊기더라도 빠른 송신 속도가 중요한 경우에 쓰임

따라서 목적에 맞게 TCP와 UDP를 적재정소에 사용하는 것이 중요.

&nbsp;

## TCP 소켓 프로그래밍

통신 과정

1. 서버 프로그램에서 서버 소켓을 사용해서 서버 컴퓨터의 특정 포트에서 클라이언트의 연결 요청을 받을 준비를 함

2. 클라이언트 프로그램이 접속할 서버의 IP주소와 포트 넘버를 가지고 소켓을 생성해서 서버에 연결을 요청함

3. 서버 소켓은 클라이언트의 연결 요청을 받고, 서버에 새로운 소켓을 생성해 클라이언트의 소켓과 연결되도록 함

4. 클라이언트의 소켓과 새로 생성된 서버 소켓이 1대1 통신을 함 (기존의 서버 소켓과는 무관)

&nbsp;

서버 소켓(Server Socket)은 포트와 binding 되어있고, 클라이언트로부터 연결 요청이 올 때마다 새로운 소켓을 생성해 클라이언트와 연결해줌.

실제 통신은 서버 소켓이 아닌 새로 생성된 소켓과 클라이언트 소켓간에 이루어짐

&nbsp;

서버 소켓을 제외한 다른 소켓은 하나의 포트를 공유할 수 있으나, 서버 소켓은 포트 하나를 독점함

> <b>포트(port)</b>
>
> 컴퓨터(호스트)가 외부와 통신을 하기 위해 사용하는 통로
>
> 호스트 당 65536(2<sup>16</sup>)개의 포트를 가지고 있음
>
> 1023번 이하의 포트는 FTP나 Telnet 같은 기존 통신 프로그램에 의해 사용되기 때문에 보통은 1024 이상의 포트 넘버를 골라서 사용함

&nbsp;

소켓이 연결될 때, 연결 통로가 바로 입출력 스트림

하나의 소켓 안에는 입력스트림과 출력스트림이 모두 들어있고, 상대편 소켓과 연결 시 교차 연결됨

> 입력 &#8594; 출력
>
> 출력 &#8594; 입력

&nbsp;

`Java`에서는 TCP 소켓 프로그래밍을 위해 `Socket`과 `ServerSocket` 클래스 제공

- `Socket`

  프로세스 간의 통신 담당

  `InputStream`과 `OutputStream` 보유

- `ServerSocket`

  포트와 연결되어있음

  > 한 포트에 하나의 `ServerSocket`만 연결 가능
  >
  > 단, 프로토콜이 다르면 같은 포트를 써도 됨

  연결 요청이 들어오면 `Socket`을 생성해서 상대방 `Socket`과 통신할 수 있게 연결해줌
